<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mielentila-tarkistus</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #1a1a1a;
      color: #eee;
      line-height: 1.6;
      margin: 0;
    }
    #box {
      background: #2c2c2c;
      padding: 22px;
      border-radius: 14px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.5);
      margin-top: 40px;
    }
    .question {
      font-size: 1.8rem;
      margin-bottom: 20px;
      font-weight: 600;
    }
    .small-note {
      font-size: 1rem;
      opacity: 0.75;
      margin-top: 14px;
    }
  </style>
</head>
<body>

<div id="box">
  <div class="question" id="question">Sano "jatkuu" aloittaaksesi tarkistuksen.</div>
  <div class="small-note">Voit sanoa milloin tahansa: "stop" keskeyttääksesi tai "jatkuu" jatkaaksesi.</div>
</div>

<script>
// ---------- Kysymykset ----------
const questions = [
  "Onko hengitys tänään suhteellisen tasainen?",
  "Tuntuuko kehossa enemmän jännitystä kuin rentoutta?",
  "Onko ajatuksia, jotka yrittävät rynniä päälle?",
  "Onko sisällä levottomuutta?",
  "Tuntuuko, että hallitset tämän hetken?",
  "Haluatko edetä tänään rauha ensin linjalla?"
];

let qIndex = -1;
let listening = false;
let stopped = false;

// ---------- Puheentunnistus ----------
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
const rec = new SpeechRecognition();
rec.continuous = true;
rec.lang = "fi-FI";

rec.onresult = (event) => {
  const text = event.results[event.results.length - 1][0].transcript.trim().toLowerCase();
  console.log("Kuultu:", text);

  if (text.includes("stop")) {
    stopped = true;
    showMessage("Keskeytetty. Sano 'jatkuu' jatkaaksesi.");
    return;
  }

  if (text.includes("jatkuu")) {
    stopped = false;
    nextQuestion();
    return;
  }

  if (!stopped && listening && (text.includes("kyllä") || text.includes("ei"))) {
    nextQuestion();
  }
};

rec.onerror = (e) => console.log("Speech error:", e);
rec.onend = () => rec.start();
rec.start();

// ---------- Teksti ruudulle + ääneen ----------
function showMessage(msg) {
  document.getElementById("question").textContent = msg;

  // --- Tekstin puheeksi (TTS) ---
  const utter = new SpeechSynthesisUtterance(msg);
  utter.lang = "fi-FI";
  utter.rate = 1.0;
  utter.pitch = 1.0;

  window.speechSynthesis.cancel();  // estää päällekkäiset puheet
  window.speechSynthesis.speak(utter);
}

// ---------- Seuraava kysymys ----------
function nextQuestion() {
  listening = true;
  qIndex++;

  if (qIndex >= questions.length) {
    showMessage("Valmis tältä erää. Sano 'jatkuu' aloittaaksesi uudelleen.");
    qIndex = -1;
    listening = false;
    return;
  }

  showMessage(questions[qIndex]);
}
</script>

</body>
</html>
