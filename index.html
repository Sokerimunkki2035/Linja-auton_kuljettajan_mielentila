<!DOCTYPE html>
<html lang="fi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Linjakuljettajan maadoitus</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background: #111827;
      color: #e5e7eb;
      margin: 0;
      text-align: center;
    }
    h1 {
      margin-top: 24px;
      font-size: 1.6rem;
    }
    #box {
      margin: 26px auto 0;
      max-width: 480px;
      background: #1f2933;
      padding: 20px;
      border-radius: 14px;
      box-shadow: 0 4px 14px rgba(0,0,0,0.5);
    }
    #status {
      font-size: 1rem;
      opacity: 0.8;
      margin-top: 12px;
      min-height: 1.6em;
    }
    button {
      margin-top: 24px;
      padding: 16px;
      font-size: 1.2rem;
      border-radius: 999px;
      border: none;
      background: #10b981;
      color: #fff;
      width: 90%;
      max-width: 320px;
    }
    #stopBtn {
      background: #ef4444;
      margin-top: 12px;
    }
  </style>
</head>
<body>
  <h1>Linjakuljettajan maadoitus</h1>

  <div id="box">
    <div id="status">
      Paina “Käynnistä” ennen ajoa. Ohjaus etenee sen jälkeen automaattisesti.
    </div>
    <button id="startBtn">KÄYNNISTÄ OHJAUS</button>
    <button id="stopBtn" style="display:none;">STOP</button>
  </div>

  <script>
    // -----------------------------------
    // WAKE LOCK - estää näytön sammumisen
    // -----------------------------------
    let wakeLock = null;

    async function enableWakeLock() {
      try {
        wakeLock = await navigator.wakeLock.request("screen");
        console.log("Wake Lock päällä");
      } catch (err) {
        console.log("Wake Lock ei toimi:", err);
      }
    }

    async function disableWakeLock() {
      try {
        if (wakeLock) {
          await wakeLock.release();
          wakeLock = null;
          console.log("Wake Lock pois");
        }
      } catch (err) {}
    }

    // -----------------------------------
    // OHJAUSTEKSIT
    // -----------------------------------
    const steps = [
      "Olen tässä kanssasi. Aloitetaan rauhallisesti. Sinun ei tarvitse muuttaa mitään. Riittää, että ajat.",
      "Tämä harjoitus pitää sinut tässä hetkessä. Kuuntelet vain. Voit vastata mielessäsi, jos haluat.",
      "Valitaan ensin ympäristö ankkuriksi. Kiinnitä huomio punaiseen väriin. Huomaa, jos näet punaisen auton, bussin tai kyltin.",
      "Kun huomaat punaisen värin, se riittää. Et laske, et suorita. Vain pieni merkki siitä, että olet läsnä.",
      "Seuraavaksi keho. Valitse yksi kohta, joka tuntuu edes yhden prosentin rennommalta.",
      "Jos tällaista kohtaa ei tunnu, sekin on täysin ok. Silloin vain huomaat, että juuri nyt on näin.",
      "Palaamme ympäristöön. Huomaa, jos näet ihmisen, jolla on päähine, lippis, huppu tai pipo.",
      "Jos et näe ketään, se on täysin ok. Harjoitus toimii silti.",
      "Nyt hengitys. Huomaa yksi uloshengitys, joka on hitusen pehmeämpi. Ei tarvitse syventää hengitystä.",
      "Hyvä. Se riittää. Se on jo maadoittumista.",
      "Anna nyt ympäristön ja kehon olla läsnä samaan aikaan.",
      "Jos mieleen tulee exä, lapset tai pettymykset, huomaat vain lauseen: ajat nyt bussia, muu hoidetaan myöhemmin.",
      "Ajoklinikka ei etsi täydellistä ihmistä, vaan ihmistä, joka tunnistaa reaktionsa. Sinä teet jo niin.",
      "Viimeinen hetki. Huomaa yksi asia, joka kertoo, että sinulla on kyky jatkaa.",
      "Hyvä. Tämä riittää tältä kierrokselta. Voit käynnistää ohjauksen uudestaan milloin tahansa."
    ];

    let running = false;
    let stopped = false;

    function speak(text, cb) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = "fi-FI";
      utter.rate = 1;
      utter.pitch = 1;

      utter.onend = () => cb && cb();

      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utter);
    }

    function runStep(i) {
      if (stopped || !running || i >= steps.length) {
        running = false;
        stopped = false;
        disableWakeLock();
        document.getElementById("status").textContent =
          "Kierros päättyi. Voit käynnistää ohjauksen uudestaan.";
        document.getElementById("startBtn").style.display = "inline-block";
        document.getElementById("stopBtn").style.display = "none";
        return;
      }

      document.getElementById("status").textContent = steps[i];

      speak(steps[i], () => {
        if (!running || stopped) return;
        setTimeout(() => runStep(i + 1), 3000);
      });
    }

    document.getElementById("startBtn").onclick = () => {
      running = true;
      stopped = false;
      enableWakeLock();
      document.getElementById("startBtn").style.display = "none";
      document.getElementById("stopBtn").style.display = "inline-block";
      runStep(0);
    };

    document.getElementById("stopBtn").onclick = () => {
      stopped = true;
      running = false;
      disableWakeLock();
      window.speechSynthesis.cancel();
      document.getElementById("status").textContent = "Ohjaus keskeytetty.";
      document.getElementById("startBtn").style.display = "inline-block";
      document.getElementById("stopBtn").style.display = "none";
    };
  </script>
</body>
</html>
